#!/usr/bin/env bash

set -g mouse on

# fix problems with escape lagging in vim
set -sg escape-time 10

# start open window index at 1
set -g base-index 1
set -g renumber-windows on

set -g status-keys vi
set -g mode-keys vi

# vim-like pane resizing  
bind -r C-k resize-pane -U
bind -r C-j resize-pane -D
bind -r C-h resize-pane -L
bind -r C-l resize-pane -R

# vim-like pane switching
bind -r k select-pane -U
bind -r j select-pane -D
bind -r h select-pane -L
bind -r l select-pane -R

# vim-like window splitting
bind -r v split-pane -h
bind -r s split-pane -v

# vim-like copy mode
bind-key -T copy-mode-vi v send -X begin-selection
bind-key -T copy-mode-vi V send -X select-line
bind-key -T copy-mode-vi y send -X copy-selection-and-cancel

# gruvbox colors
dark0_hard="#1D2021"
dark0="#282828"
dark0_soft="#32302F"
dark1="#3C3836"
dark2="#504945"
dark3="#665C54"
dark4="#7C6F64"
light0_hard="#F9F5D7"
light0="#FBF1C7"
light0_soft="#F2E5BC"
light1="#EBDBB2"
light2="#D5C4A1"
light3="#BDAE93"
light4="#A89984"
bright_red="#FB4934"
bright_green="#B8BB26"
bright_yellow="#FABD2F"
bright_blue="#83A598"
bright_purple="#D3869B"
bright_aqua="#8EC07C"
bright_orange="#FE8019"
neutral_red="#CC241D"
neutral_green="#98971A"
neutral_yellow="#D79921"
neutral_blue="#458588"
neutral_purple="#B16286"
neutral_aqua="#689D6A"
neutral_orange="#D65D0E"
gray="#928374"

########## STATUS LINE ##########
# # left_separator=''
# # right_separator=''

# # session section (left)
# # session_icon=""
# session_icon=""
# session_bg="${dark1}"
# session_fg="${light2}"
# session_prefix_bg="${bright_yellow}"
# session_prefix_fg="${dark0_hard}"
# session_copy_bg="${bright_red}"
# session_copy_fg="${dark0_hard}"
# mode_highlight_color="#{?pane_in_mode,${session_copy_bg},#{?client_prefix,${session_prefix_bg},${session_bg}}}"
# mode_highlight_text="#{?pane_in_mode,${session_copy_fg},#{?client_prefix,${session_prefix_fg},${session_fg}}}"
# session_icon_section="#{?pane_in_mode,,#{?client_prefix,,${session_icon}}}"
# session_section="#[bg=${mode_highlight_color},fg=${mode_highlight_text}] ${session_icon_section}  #S  "
# session_section="#[bg=${mode_highlight_color},fg=${mode_highlight_text}] ${session_icon_section}  #S  #[fg=${mode_highlight_color},bg=${mode_highlight_text}] ${right_separator} "

# window section (middle)
window_section="#[fg=${light3}]#[bg=${dark1}] #I #W "
current_window_section="#[fg=${dark0_hard},bg=${light2}] #I #W "
# window_section="#[bg=${background2},fg=${background1}]${right_separator}#[fg=${foreground}]#[bg=${background2}] #I #W #[bg=${background1},fg=${background2}]${right_separator}"
# current_window_section="#[bg=${light2},fg=${dark0_hard}]${right_separator}#[fg=${dark0_hard},bg=${light2}] #I #W #[bg=${dark0_hard},fg=${light2}]${right_separator}"

# info section (right)
# battery_section="#[bg=${background1},fg=${blue}]${left_separator}#[bg=${blue},fg=${background}] #{battery_icon_charge}#{battery_icon_status} #{battery_percentage}  "
cpu_section="#[bg=${dark0_hard},fg=${light2}]${left_separator}#[bg=${light2},fg=${dark0_hard}]  #{cpu_percentage}  "
# date_section="#[bg=${yellow},fg=${orange}]${left_separator}#[bg=${orange},fg=${background}] 󰸗  %b %d  "
# time_section="#[bg=${orange},fg=${green}]${left_separator}#[bg=${green},fg=${background}]   %H:%M "

# TODO: change these to use my colors
set-option -g status-style "bg=#{dark2},fg=${light2}"
# set-option -g status-left "${session_section}"
set-option -g status-left "#{tmux_mode_indicator} "
set-window-option -g window-status-current-format "${current_window_section}"
set-window-option -g window-status-format "${window_section}"
set-option -g status-right "#{now_playing}${cpu_section}" # ${battery_section}...${date_section}${time_section}
set-option -g status-position top
set-option -g status-left-length 40
set-option -g status-right-length 130

# status line colors
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

set-window-option -g window-status-activity-style "bold"
set-window-option -g window-status-bell-style "bold"
set-option -g status-justify left

# set -g @batt_icon_charge_tier8 '󰁹'
# set -g @batt_icon_charge_tier7 '󰂁'
# set -g @batt_icon_charge_tier6 '󰂀'
# set -g @batt_icon_charge_tier5 '󰁿'
# set -g @batt_icon_charge_tier4 '󰁾'
# set -g @batt_icon_charge_tier3 '󰁼'
# set -g @batt_icon_charge_tier2 '󰁻'
# set -g @batt_icon_charge_tier1 '󰁺'
# set -g @batt_icon_status_charging '󱐋'
# set -g @batt_icon_status_charged '󱐋'
# set -g @batt_icon_status_discharging ' '
# set -g @batt_icon_status_attached '󱐋'

set -g @now-playing-status-format "{icon} #[fg=#D5C4A1]{scrollable} "
set -g @now-playing-playing-icon "#[fg=#FABD2F]󰐊"
set -g @now-playing-paused-icon "#[fg=#FB4934]󰏤"
set -g @now-playing-stopped-icon "#[fg=#FB4934]󰓛"
set -g @now-playing-scrollable-threshold 20
set -g @now-playing-auto-interval yes
set -g @now-playing-play-pause-key "p"
set -g @now-playing-stop-key "\\"
set -g @now-playing-previous-key "<"
set -g @now-playing-next-key ">"

set -g @cpu_percentage_format "%5i%%"

# List of plugins
# ~/.tmux.conf
set -g @mode_indicator_prefix_mode_style 'bg=#FABD2F,fg=#1D2021'
set -g @mode_indicator_copy_mode_style 'bg=#FB4934,fg=#1D2021'
set -g @mode_indicator_sync_mode_style 'bg=#3C3836,fg=#D5C4A1'
set -g @mode_indicator_empty_mode_style 'bg=#3C3836,fg=#D5C4A1'
set -g @mode_indicator_prefix_prompt '    #S  '
set -g @mode_indicator_copy_prompt '    #S  '
set -g @mode_indicator_sync_prompt '    #S  '
set -g @mode_indicator_empty_prompt '    #S  '

set -g @plugin 'tmux-plugins/tpm' # mandatory
set -g @plugin 'tmux-plugins/tmux-sensible' # optional recommended
set -g @plugin 'MunifTanjim/tmux-mode-indicator'
set -g @plugin 'tmux-plugins/tmux-cpu'
set -g @plugin 'spywhere/tmux-now-playing'

# resource config file
bind r source-file ~/.tmux.conf

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
